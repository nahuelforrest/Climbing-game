<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Smooth Climbing with Rest Spots</title>
<style>
  body {
    margin: 0;
    background: #87ceeb;
    overflow: hidden;
    font-family: Arial, sans-serif;
    position: relative;
  }
  canvas {
    display: block;
    margin: auto;
    background: #a0522d;
    background-image: linear-gradient(
      to bottom,
      #8b5a2b 0%,
      #7a4f24 50%,
      #5c3a17 100%
    );
  }
  #staminaBarContainer {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 20px;
    border: 2px solid black;
    background: #ccc;
    border-radius: 10px;
    overflow: hidden;
    z-index: 5;
  }
  #staminaBar {
    height: 100%;
    background: #4caf50;
    width: 100%;
    transition: width 0.1s;
  }
  #score {
    position: absolute;
    top: 40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 20px;
    color: black;
    font-weight: bold;
    text-shadow: 1px 1px 2px white;
  }
</style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div id="staminaBarContainer">
    <div id="staminaBar"></div>
  </div>
  <div id="score">Score: 0</div>
<script>
window.onload = function() {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const staminaBar = document.getElementById("staminaBar");
  const scoreDisplay = document.getElementById("score");

  const maxStamina = 100;
  let stamina = maxStamina;

  let score = 0;

  // Player object with smooth position & velocity
  const player = {
    x: 180,
    y: 550,
    width: 40,
    height: 40,
    vx: 0,
    vy: 0,
    speed: 2.5,
  };

  // Controls state
  const keys = {};

  document.addEventListener("keydown", e => keys[e.code] = true);
  document.addEventListener("keyup", e => keys[e.code] = false);

  // Rest spots: spaced out, with types "good" (full regen) or "bad" (partial)
  const restSpots = [
    {x: 100, y: 500, width: 60, height: 15, type: "good"},
    {x: 250, y: 400, width: 60, height: 15, type: "bad"},
    {x: 50,  y: 300, width: 60, height: 15, type: "good"},
    {x: 280, y: 200, width: 60, height: 15, type: "bad"},
    {x: 150, y: 100, width: 60, height: 15, type: "good"},
  ];

  function update() {
    // Update velocity based on keys, only if stamina > 0
    if (stamina > 0) {
      player.vx = 0;
      player.vy = 0;
      if (keys["ArrowLeft"]) player.vx = -player.speed;
      if (keys["ArrowRight"]) player.vx = player.speed;
      if (keys["ArrowUp"]) player.vy = -player.speed;
      if (keys["ArrowDown"]) player.vy = player.speed;

      if (player.vx !== 0 || player.vy !== 0) {
        stamina -= 0.3; // drain stamina while moving
        if (stamina < 0) stamina = 0;
      }
    } else {
      // No stamina means no movement
      player.vx = 0;
      player.vy = 0;
    }

    // Move player
    player.x += player.vx;
    player.y += player.vy;

    // Keep player inside canvas bounds
    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    if (player.y < 0) player.y = 0;
    if (player.y + player.height > canvas.height) player.y = canvas.height - player.height;

    // Check if player is resting on a rest spot
    let resting = false;
    for (const spot of restSpots) {
      if (
        player.x < spot.x + spot.width &&
        player.x + player.width > spot.x &&
        player.y < spot.y + spot.height &&
        player.y + player.height > spot.y
      ) {
        resting = true;
        // Recover stamina based on rest spot type
        if (spot.type === "good") {
          stamina += 0.5;
        } else if (spot.type === "bad") {
          stamina += 0.15;
        }
        if (stamina > maxStamina) stamina = maxStamina;
        break;
      }
    }

    // Increase score as player climbs higher (y decreases)
    // Simple scoring: score = max height climbed (canvas.height - player.y)
    let newScore = Math.floor(canvas.height - player.y);
    if (newScore > score) score = newScore;

    staminaBar.style.width = (stamina / maxStamina * 100) + "%";
    scoreDisplay.textContent = "Score: " + score;
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw player
    ctx.fillStyle = "red";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Draw rest spots
    for (const spot of restSpots) {
      if (spot.type === "good") {
        ctx.fillStyle = "#b5651d"; // brown for good rests
      } else {
        ctx.fillStyle = "#a1887f"; // duller brown/grey for bad rests
      }
      ctx.fillRect(spot.x, spot.y, spot.width, spot.height);
    }
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
};
</script>
</body>
</html>
